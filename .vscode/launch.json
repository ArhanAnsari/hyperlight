{
  // Use IntelliSense to learn about possible attributes.
  // Hover to view descriptions of existing attributes.
  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
  "version": "0.2.0",
  "configurations": [
    {
      "name": ".NET Core Launch Native Host Example",
      "type": "coreclr",
      "request": "launch",
      "preLaunchTask": "Build NativeHost Example",
      "program": "${workspaceFolder}/src/examples/NativeHost/bin/debug/net6.0/NativeHost",
      "args": [],
      "cwd": "${workspaceFolder}",
      "stopAtEntry": true,
      "console": "internalConsole",
      "justMyCode": false
    },
    {
      "name": "Attach dotnet debugger",
      "type": "coreclr",
      "request": "attach",
      "processId": "${command:pickProcess}"
    },
    {
      "name": "Debug Native Guest",
      "type": "cppvsdbg",
      "request": "launch",
      "program": "${workspaceFolder}/src/examples/NativeHost/bin/debug/net6.0/NativeHost.exe",
      "args": [],
      "stopAtEntry": false,
      "cwd": "${workspaceFolder}/src/examples/NativeHost/bin/debug/net6.0",
      "environment": [],
      "externalConsole": false,
      "preLaunchTask": "Build Example Host"
    },
    {
      "type": "lldb",
      "request": "launch",
      "name": "Debug Tests",
      "args": ["--no-fork"],
      "env": {
        "LD_LIBRARY_PATH": "${workspaceFolder}/target/debug",
        "HYPERV_SHOULD_BE_PRESENT": "true"
      },
      "program": "${workspaceFolder}/src/hyperlight_host/bin/test_c",
      "cwd": "${workspaceFolder}/src/hyperlight_host",
      "stopOnEntry": true,
      "sourceLanguages": ["rust", "c"],
      "console": "internalConsole"
    },
    {
      "type": "lldb",
      "request": "attach",
      "name": "Attach LLDB",
      "pid": "${command:pickMyProcess}" // use ${command:pickProcess} to pick other users' processes
    },
    {
        "type": "lldb",
        "request": "launch",
        "name": "Debug Native code in NativeHost",
        "args": [],
        "program": "${workspaceFolder}/src/examples/NativeHost/bin/debug/net6.0/NativeHost",
        "windows": {
          "program": "${workspaceFolder}/src/examples/NativeHost/bin/debug/net6.0/NativeHost.exe"
        },
        "cwd": "${workspaceFolder}",
        "stopOnEntry": true,
        "sourceLanguages": ["rust", "c"],
        "console": "internalConsole"
      },
      // Use this to debug a test build with release optimizations
      {
        "type": "lldb",
        "request": "launch",
        "name": "Cargo test",
        "cargo": {
          "args": [
            "test",
            "--profile=release-with-debug",
            "--lib",
            "--no-run",
          ],
          "filter": {
            "name": "hyperlight_host",
            "kind": "lib"
          }
        },
        "args": ["sandbox::initialized_single_use::tests"]
      },
      {
        "type": "lldb",
        "request": "launch",
        "name": "Cargo debug integration_test",
        "cargo": {
          "args": [
            "test",
            "--profile=dev",
            "--no-run",
          ],
          "filter": {
            "name": "integration_test",
          }
        },
       "args": ["test_guest_abort"] // the specific test to run
      }
  ]
}
